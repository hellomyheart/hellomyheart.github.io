(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{548:function(a,s,v){"use strict";v.r(s);var e=v(14),_=Object(e.a)({},(function(){var a=this,s=a.$createElement,v=a._self._c||s;return v("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[v("p",[a._v("在Java中，我们经常听到"),v("code",[a._v("classpath")]),a._v("这个东西。网上有很多关于“如何设置classpath”的文章，但大部分设置都不靠谱。")]),a._v(" "),v("p",[a._v("到底什么是"),v("code",[a._v("classpath")]),a._v("？")]),a._v(" "),v("p",[v("code",[a._v("classpath")]),a._v("是JVM用到的一个环境变量，它用来指示JVM如何搜索"),v("code",[a._v("class")]),a._v("。")]),a._v(" "),v("p",[a._v("因为Java是编译型语言，源码文件是"),v("code",[a._v(".java")]),a._v("，而编译后的"),v("code",[a._v(".class")]),a._v("文件才是真正可以被JVM执行的字节码。因此，JVM需要知道，如果要加载一个"),v("code",[a._v("abc.xyz.Hello")]),a._v("的类，应该去哪搜索对应的"),v("code",[a._v("Hello.class")]),a._v("文件。")]),a._v(" "),v("p",[a._v("所以，"),v("code",[a._v("classpath")]),a._v("就是一组目录的集合，它设置的搜索路径与操作系统相关。例如，在Windows系统上，用"),v("code",[a._v(";")]),a._v("分隔，带空格的目录用"),v("code",[a._v('""')]),a._v("括起来，可能长这样：")]),a._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[a._v('C:\\work\\project1\\bin;C:\\shared;"D:\\My Documents\\project1\\bin"\n')])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("在Linux系统上，用"),v("code",[a._v(":")]),a._v("分隔，可能长这样：")]),a._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[a._v("/usr/shared:/usr/local/bin:/home/liaoxuefeng/bin\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("现在我们假设"),v("code",[a._v("classpath")]),a._v("是"),v("code",[a._v(".;C:\\work\\project1\\bin;C:\\shared")]),a._v("，当JVM在加载"),v("code",[a._v("abc.xyz.Hello")]),a._v("这个类时，会依次查找：")]),a._v(" "),v("ul",[v("li",[a._v("<当前目录>\\abc\\xyz\\Hello.class")]),a._v(" "),v("li",[a._v("C:\\work\\project1\\bin\\abc\\xyz\\Hello.class")]),a._v(" "),v("li",[a._v("C:\\shared\\abc\\xyz\\Hello.class")])]),a._v(" "),v("p",[a._v("注意到"),v("code",[a._v(".")]),a._v("代表当前目录。如果JVM在某个路径下找到了对应的"),v("code",[a._v("class")]),a._v("文件，就不再往后继续搜索。如果所有路径下都没有找到，就报错。")]),a._v(" "),v("p",[v("code",[a._v("classpath")]),a._v("的设定方法有两种：")]),a._v(" "),v("p",[a._v("在系统环境变量中设置"),v("code",[a._v("classpath")]),a._v("环境变量，不推荐；")]),a._v(" "),v("p",[a._v("在启动JVM时设置"),v("code",[a._v("classpath")]),a._v("变量，推荐。")]),a._v(" "),v("p",[a._v("我们强烈"),v("em",[a._v("不推荐")]),a._v("在系统环境变量中设置"),v("code",[a._v("classpath")]),a._v("，那样会污染整个系统环境。在启动JVM时设置"),v("code",[a._v("classpath")]),a._v("才是推荐的做法。实际上就是给"),v("code",[a._v("java")]),a._v("命令传入"),v("code",[a._v("-classpath")]),a._v("或"),v("code",[a._v("-cp")]),a._v("参数：")]),a._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[a._v("java -classpath "),v("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("C:"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("work"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("project1"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("bin"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("C:"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("shared abc.xyz.Hello\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("或者使用"),v("code",[a._v("-cp")]),a._v("的简写：")]),a._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[a._v("java -cp "),v("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("C:"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("work"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("project1"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("bin"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("C:"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("shared abc.xyz.Hello\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("没有设置系统环境变量，也没有传入"),v("code",[a._v("-cp")]),a._v("参数，那么JVM默认的"),v("code",[a._v("classpath")]),a._v("为"),v("code",[a._v(".")]),a._v("，即当前目录：")]),a._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[a._v("java abc.xyz.Hello\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("上述命令告诉JVM只在当前目录搜索"),v("code",[a._v("Hello.class")]),a._v("。")]),a._v(" "),v("p",[a._v("在IDE中运行Java程序，IDE自动传入的"),v("code",[a._v("-cp")]),a._v("参数是当前工程的"),v("code",[a._v("bin")]),a._v("目录和引入的jar包。")]),a._v(" "),v("p",[a._v("通常，我们在自己编写的"),v("code",[a._v("class")]),a._v("中，会引用Java核心库的"),v("code",[a._v("class")]),a._v("，例如，"),v("code",[a._v("String")]),a._v("、"),v("code",[a._v("ArrayList")]),a._v("等。这些"),v("code",[a._v("class")]),a._v("应该上哪去找？")]),a._v(" "),v("p",[a._v("有很多“如何设置classpath”的文章会告诉你把JVM自带的"),v("code",[a._v("rt.jar")]),a._v("放入"),v("code",[a._v("classpath")]),a._v("，但事实上，根本不需要告诉JVM如何去Java核心库查找"),v("code",[a._v("class")]),a._v("，JVM怎么可能笨到连自己的核心库在哪都不知道？")]),a._v(" "),v("p",[a._v("不要把任何Java核心库添加到classpath中！JVM根本不依赖classpath加载核心库！")]),a._v(" "),v("p",[a._v("更好的做法是，不要设置"),v("code",[a._v("classpath")]),a._v("！默认的当前目录"),v("code",[a._v(".")]),a._v("对于绝大多数情况都够用了。")]),a._v(" "),v("h3",{attrs:{id:"jar包"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#jar包"}},[a._v("#")]),a._v(" jar包")]),a._v(" "),v("p",[a._v("如果有很多"),v("code",[a._v(".class")]),a._v("文件，散落在各层目录中，肯定不便于管理。如果能把目录打一个包，变成一个文件，就方便多了。")]),a._v(" "),v("p",[a._v("jar包就是用来干这个事的，它可以把"),v("code",[a._v("package")]),a._v("组织的目录层级，以及各个目录下的所有文件（包括"),v("code",[a._v(".class")]),a._v("文件和其他文件）都打成一个jar文件，这样一来，无论是备份，还是发给客户，就简单多了。")]),a._v(" "),v("p",[a._v("jar包实际上就是一个zip格式的压缩文件，而jar包相当于目录。如果我们要执行一个jar包的"),v("code",[a._v("class")]),a._v("，就可以把jar包放到"),v("code",[a._v("classpath")]),a._v("中：")]),a._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[a._v("java -cp ./hello.jar abc.xyz.Hello\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("这样JVM会自动在"),v("code",[a._v("hello.jar")]),a._v("文件里去搜索某个类。")]),a._v(" "),v("p",[a._v("那么问题来了：如何创建jar包？")]),a._v(" "),v("p",[a._v("因为jar包就是zip包，所以，直接在资源管理器中，找到正确的目录，点击右键，在弹出的快捷菜单中选择“发送到”，“压缩(zipped)文件夹”，就制作了一个zip文件。然后，把后缀从"),v("code",[a._v(".zip")]),a._v("改为"),v("code",[a._v(".jar")]),a._v("，一个jar包就创建成功。")]),a._v(" "),v("p",[a._v("假设编译输出的目录结构是这样：")]),a._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[a._v("package_sample\n└─ bin\n   ├─ hong\n   │  └─ Person.class\n   │  ming\n   │  └─ Person.class\n   └─ mr\n      └─ jun\n         └─ Arrays.class\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br"),v("span",{staticClass:"line-number"},[a._v("2")]),v("br"),v("span",{staticClass:"line-number"},[a._v("3")]),v("br"),v("span",{staticClass:"line-number"},[a._v("4")]),v("br"),v("span",{staticClass:"line-number"},[a._v("5")]),v("br"),v("span",{staticClass:"line-number"},[a._v("6")]),v("br"),v("span",{staticClass:"line-number"},[a._v("7")]),v("br"),v("span",{staticClass:"line-number"},[a._v("8")]),v("br"),v("span",{staticClass:"line-number"},[a._v("9")]),v("br")])]),v("p",[a._v("这里需要特别注意的是，jar包里的第一层目录，不能是"),v("code",[a._v("bin")]),a._v("，而应该是"),v("code",[a._v("hong")]),a._v("、"),v("code",[a._v("ming")]),a._v("、"),v("code",[a._v("mr")]),a._v("。如果在Windows的资源管理器中看，应该长这样：")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://zeroone-bucket.oss-cn-beijing.aliyuncs.com/hexo-client/20200701202916.jpeg",alt:"hello.zip.ok"}})]),a._v(" "),v("p",[a._v("如果长这样：")]),a._v(" "),v("p",[v("img",{attrs:{src:"https://zeroone-bucket.oss-cn-beijing.aliyuncs.com/hexo-client/20200701202923.jpeg",alt:"hello.zip.invalid"}})]),a._v(" "),v("p",[a._v("说明打包打得有问题，JVM仍然无法从jar包中查找正确的"),v("code",[a._v("class")]),a._v("，原因是"),v("code",[a._v("hong.Person")]),a._v("必须按"),v("code",[a._v("hong/Person.class")]),a._v("存放，而不是"),v("code",[a._v("bin/hong/Person.class")]),a._v("。")]),a._v(" "),v("blockquote",[v("p",[a._v("jar包内应该有bin下的文件（夹）,而不应该包含bin这个文件夹。")])]),a._v(" "),v("p",[a._v("jar包还可以包含一个特殊的"),v("code",[a._v("/META-INF/MANIFEST.MF")]),a._v("文件，"),v("code",[a._v("MANIFEST.MF")]),a._v("是纯文本，可以指定"),v("code",[a._v("Main-Class")]),a._v("和其它信息。JVM会自动读取这个"),v("code",[a._v("MANIFEST.MF")]),a._v("文件，如果存在"),v("code",[a._v("Main-Class")]),a._v("，我们就不必在命令行指定启动的类名，而是用更方便的命令：")]),a._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[a._v("java -jar hello.jar\n")])]),a._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[a._v("1")]),v("br")])]),v("p",[a._v("jar包还可以包含其它jar包，这个时候，就需要在"),v("code",[a._v("MANIFEST.MF")]),a._v("文件里配置"),v("code",[a._v("classpath")]),a._v("了。")]),a._v(" "),v("p",[a._v("在大型项目中，不可能手动编写"),v("code",[a._v("MANIFEST.MF")]),a._v("文件，再手动创建zip包。Java社区提供了大量的开源构建工具，例如"),v("a",{attrs:{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1255945359327200",target:"_blank",rel:"noopener noreferrer"}},[a._v("Maven"),v("OutboundLink")],1),a._v("，可以非常方便地创建jar包。")]),a._v(" "),v("blockquote",[v("p",[a._v("jar包的相关知识了解即可，后期我们会使用maven工具，很少手动创建jar包。")])]),a._v(" "),v("h3",{attrs:{id:"小结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[a._v("#")]),a._v(" 小结")]),a._v(" "),v("p",[a._v("JVM通过环境变量"),v("code",[a._v("classpath")]),a._v("决定搜索"),v("code",[a._v("class")]),a._v("的路径和顺序；")]),a._v(" "),v("p",[a._v("不推荐设置系统环境变量"),v("code",[a._v("classpath")]),a._v("，始终建议通过"),v("code",[a._v("-cp")]),a._v("命令传入；")]),a._v(" "),v("p",[a._v("jar包相当于目录，可以包含很多"),v("code",[a._v(".class")]),a._v("文件，方便下载和使用；")]),a._v(" "),v("p",[v("code",[a._v("MANIFEST.MF")]),a._v("文件可以提供jar包的信息，如"),v("code",[a._v("Main-Class")]),a._v("，这样可以直接运行jar包。")])])}),[],!1,null,null,null);s.default=_.exports}}]);