(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{551:function(a,s,e){"use strict";e.r(s);var n=e(14),t=Object(n.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("从Java 9开始，JDK又引入了模块（Module）。")]),a._v(" "),e("blockquote",[e("p",[a._v("了解即可，jdk8不支持。")])]),a._v(" "),e("p",[a._v("什么是模块？这要从Java 9之前的版本说起。")]),a._v(" "),e("p",[a._v("我们知道，"),e("code",[a._v(".class")]),a._v("文件是JVM看到的最小可执行文件，而一个大型程序需要编写很多Class，并生成一堆"),e("code",[a._v(".class")]),a._v("文件，很不便于管理，所以，"),e("code",[a._v("jar")]),a._v("文件就是"),e("code",[a._v("class")]),a._v("文件的容器。")]),a._v(" "),e("p",[a._v("在Java 9之前，一个大型Java程序会生成自己的jar文件，同时引用依赖的第三方jar文件，而JVM自带的Java标准库，实际上也是以jar文件形式存放的，这个文件叫"),e("code",[a._v("rt.jar")]),a._v("，一共有60多M。")]),a._v(" "),e("p",[a._v("如果是自己开发的程序，除了一个自己的"),e("code",[a._v("app.jar")]),a._v("以外，还需要一堆第三方的jar包，运行一个Java程序，一般来说，命令行写这样：")]),a._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[a._v("java "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cp app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jar"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("a"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jar"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("b"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jar"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jar "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("liaoxuefeng"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sample"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),a._v("Main")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("注意：JVM自带的标准库rt.jar不要写到classpath中，写了反而会干扰JVM的正常运行。")]),a._v(" "),e("p",[a._v("如果漏写了某个运行时需要用到的jar，那么在运行期极有可能抛出"),e("code",[a._v("ClassNotFoundException")]),a._v("。")]),a._v(" "),e("p",[a._v("所以，jar只是用于存放class的容器，它并不关心class之间的依赖。")]),a._v(" "),e("p",[a._v("从Java 9开始引入的模块，主要是为了解决“依赖”这个问题。如果"),e("code",[a._v("a.jar")]),a._v("必须依赖另一个"),e("code",[a._v("b.jar")]),a._v("才能运行，那我们应该给"),e("code",[a._v("a.jar")]),a._v("加点说明啥的，让程序在编译和运行的时候能自动定位到"),e("code",[a._v("b.jar")]),a._v("，这种自带“依赖关系”的class容器就是模块。")]),a._v(" "),e("p",[a._v("为了表明Java模块化的决心，从Java 9开始，原有的Java标准库已经由一个单一巨大的"),e("code",[a._v("rt.jar")]),a._v("分拆成了几十个模块，这些模块以"),e("code",[a._v(".jmod")]),a._v("扩展名标识，可以在"),e("code",[a._v("$JAVA_HOME/jmods")]),a._v("目录下找到它们：")]),a._v(" "),e("ul",[e("li",[a._v("java.base.jmod")]),a._v(" "),e("li",[a._v("java.compiler.jmod")]),a._v(" "),e("li",[a._v("java.datatransfer.jmod")]),a._v(" "),e("li",[a._v("java.desktop.jmod")]),a._v(" "),e("li",[a._v("...")])]),a._v(" "),e("p",[a._v("这些"),e("code",[a._v(".jmod")]),a._v("文件每一个都是一个模块，模块名就是文件名。例如：模块"),e("code",[a._v("java.base")]),a._v("对应的文件就是"),e("code",[a._v("java.base.jmod")]),a._v("。模块之间的依赖关系已经被写入到模块内的"),e("code",[a._v("module-info.class")]),a._v("文件了。所有的模块都直接或间接地依赖"),e("code",[a._v("java.base")]),a._v("模块，只有"),e("code",[a._v("java.base")]),a._v("模块不依赖任何模块，它可以被看作是“根模块”，好比所有的类都是从"),e("code",[a._v("Object")]),a._v("直接或间接继承而来。")]),a._v(" "),e("p",[a._v("把一堆class封装为jar仅仅是一个打包的过程，而把一堆class封装为模块则不但需要打包，还需要写入依赖关系，并且还可以包含二进制代码（通常是JNI扩展）。此外，模块支持多版本，即在同一个模块中可以为不同的JVM提供不同的版本。")]),a._v(" "),e("h3",{attrs:{id:"编写模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写模块"}},[a._v("#")]),a._v(" 编写模块")]),a._v(" "),e("p",[a._v("那么，我们应该如何编写模块呢？还是以具体的例子来说。首先，创建模块和原有的创建Java项目是完全一样的，以"),e("code",[a._v("oop-module")]),a._v("工程为例，它的目录结构如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("oop-module\n├── bin\n├── build.sh\n└── src\n    ├── com\n    │   └── itranswarp\n    │       └── sample\n    │           ├── Greeting.java\n    │           └── Main.java\n    └── module-info.java\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("p",[a._v("其中，"),e("code",[a._v("bin")]),a._v("目录存放编译后的class文件，"),e("code",[a._v("src")]),a._v("目录存放源码，按包名的目录结构存放，仅仅在"),e("code",[a._v("src")]),a._v("目录下多了一个"),e("code",[a._v("module-info.java")]),a._v("这个文件，这就是模块的描述文件。在这个模块中，它长这样：")]),a._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("module")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("hello"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("world")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("requires")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("base")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可不写，任何模块都会自动引入java.base")]),a._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("requires")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("xml")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("其中，"),e("code",[a._v("module")]),a._v("是关键字，后面的"),e("code",[a._v("hello.world")]),a._v("是模块的名称，它的命名规范与包一致。花括号的"),e("code",[a._v("requires xxx;")]),a._v("表示这个模块需要引用的其他模块名。除了"),e("code",[a._v("java.base")]),a._v("可以被自动引入外，这里我们引入了一个"),e("code",[a._v("java.xml")]),a._v("的模块。")]),a._v(" "),e("p",[a._v("当我们使用模块声明了依赖关系后，才能使用引入的模块。例如，"),e("code",[a._v("Main.java")]),a._v("代码如下：")]),a._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("itranswarp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sample")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 必须引入java.xml模块后才能使用其中的类:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("javax"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("xml"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("XMLConstants")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Main")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Greeting")]),a._v(" g "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Greeting")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("g"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("hello")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("XMLConstants")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("XML_NS_PREFIX"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br")])]),e("p",[a._v("如果把"),e("code",[a._v("requires java.xml;")]),a._v("从"),e("code",[a._v("module-info.java")]),a._v("中去掉，编译将报错。可见，模块的重要作用就是声明依赖关系。")]),a._v(" "),e("p",[a._v("下面，我们用JDK提供的命令行工具来编译并创建模块。")]),a._v(" "),e("p",[a._v("首先，我们把工作目录切换到"),e("code",[a._v("oop-module")]),a._v("，在当前目录下编译所有的"),e("code",[a._v(".java")]),a._v("文件，并存放到"),e("code",[a._v("bin")]),a._v("目录下，命令如下：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ javac -d bin src/module-info.java src/com/itranswarp/sample/*.java\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("blockquote",[e("p",[a._v("D:\\jdk-14.0.1\\bin\\javac -d bin src/module-info.java src/com/itranswarp/sample/*.java")])]),a._v(" "),e("p",[a._v("如果编译成功，现在项目结构如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("oop-module\n├── bin\n│   ├── com\n│   │   └── itranswarp\n│   │       └── sample\n│   │           ├── Greeting.class\n│   │           └── Main.class\n│   └── module-info.class\n└── src\n    ├── com\n    │   └── itranswarp\n    │       └── sample\n    │           ├── Greeting.java\n    │           └── Main.java\n    └── module-info.java\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("p",[a._v("注意到"),e("code",[a._v("src")]),a._v("目录下的"),e("code",[a._v("module-info.java")]),a._v("被编译到"),e("code",[a._v("bin")]),a._v("目录下的"),e("code",[a._v("module-info.class")]),a._v("。")]),a._v(" "),e("p",[a._v("下一步，我们需要把bin目录下的所有class文件先打包成jar，在打包的时候，注意传入"),e("code",[a._v("--main-class")]),a._v("参数，让这个jar包能自己定位"),e("code",[a._v("main")]),a._v("方法所在的类：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ jar --create --file hello.jar --main-class com.itranswarp.sample.Main -C bin "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("blockquote",[e("p",[a._v("默认jdk不是14的，要不全java路径，下同。")]),a._v(" "),e("p",[a._v("例如：")]),a._v(" "),e("p",[a._v("D:/java/jdk-14.0.1/bin/jar --create --file hello.jar --main-class com.itranswarp.sample.Main -C bin .")])]),a._v(" "),e("p",[a._v("现在我们就在当前目录下得到了"),e("code",[a._v("hello.jar")]),a._v("这个jar包，它和普通jar包并无区别，可以直接使用命令"),e("code",[a._v("java -jar hello.jar")]),a._v("来运行它。但是我们的目标是创建模块，所以，继续使用JDK自带的"),e("code",[a._v("jmod")]),a._v("命令把一个jar包转换成模块：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ jmod create --class-path hello.jar hello.jmod\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("于是，在当前目录下我们又得到了"),e("code",[a._v("hello.jmod")]),a._v("这个模块文件，这就是最后打包出来的传说中的模块！")]),a._v(" "),e("h3",{attrs:{id:"运行模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行模块"}},[a._v("#")]),a._v(" 运行模块")]),a._v(" "),e("p",[a._v("要运行一个jar，我们使用"),e("code",[a._v("java -jar xxx.jar")]),a._v("命令。要运行一个模块，我们只需要指定模块名。试试：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ java --module-path hello.jmod --module hello.world\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("结果是一个错误：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("Error occurred during initialization of boot layer\njava.lang.module.FindException: JMOD format not supported at execution time: hello.jmod\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("原因是"),e("code",[a._v(".jmod")]),a._v("不能被放入"),e("code",[a._v("--module-path")]),a._v("中。换成"),e("code",[a._v(".jar")]),a._v("就没问题了：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ java --module-path hello.jar --module hello.world\nHello, xml"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("那我们辛辛苦苦创建的"),e("code",[a._v("hello.jmod")]),a._v("有什么用？答案是我们可以用它来打包JRE。")]),a._v(" "),e("h3",{attrs:{id:"打包jre"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#打包jre"}},[a._v("#")]),a._v(" 打包JRE")]),a._v(" "),e("p",[a._v("前面讲了，为了支持模块化，Java 9首先带头把自己的一个巨大无比的"),e("code",[a._v("rt.jar")]),a._v("拆成了几十个"),e("code",[a._v(".jmod")]),a._v("模块，原因就是，运行Java程序的时候，实际上我们用到的JDK模块，并没有那么多。不需要的模块，完全可以删除。")]),a._v(" "),e("p",[a._v("过去发布一个Java应用程序，要运行它，必须下载一个完整的JRE，再运行jar包。而完整的JRE块头很大，有100多M。怎么给JRE瘦身呢？")]),a._v(" "),e("p",[a._v("现在，JRE自身的标准库已经分拆成了模块，只需要带上程序用到的模块，其他的模块就可以被裁剪掉。怎么裁剪JRE呢？并不是说把系统安装的JRE给删掉部分模块，而是“复制”一份JRE，但只带上用到的模块。为此，JDK提供了"),e("code",[a._v("jlink")]),a._v("命令来干这件事。命令如下：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ jlink --module-path hello.jmod --add-modules java.base,java.xml,hello.world --output jre/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("我们在"),e("code",[a._v("--module-path")]),a._v("参数指定了我们自己的模块"),e("code",[a._v("hello.jmod")]),a._v("，然后，在"),e("code",[a._v("--add-modules")]),a._v("参数中指定了我们用到的3个模块"),e("code",[a._v("java.base")]),a._v("、"),e("code",[a._v("java.xml")]),a._v("和"),e("code",[a._v("hello.world")]),a._v("，用"),e("code",[a._v(",")]),a._v("分隔。最后，在"),e("code",[a._v("--output")]),a._v("参数指定输出目录。")]),a._v(" "),e("p",[a._v("现在，在当前目录下，我们可以找到"),e("code",[a._v("jre")]),a._v("目录，这是一个完整的并且带有我们自己"),e("code",[a._v("hello.jmod")]),a._v("模块的JRE。试试直接运行这个JRE：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ jre/bin/java --module hello.world\nHello, xml"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("要分发我们自己的Java应用程序，只需要把这个"),e("code",[a._v("jre")]),a._v("目录打个包给对方发过去，对方直接运行上述命令即可，既不用下载安装JDK，也不用知道如何配置我们自己的模块，极大地方便了分发和部署。")]),a._v(" "),e("h3",{attrs:{id:"访问权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问权限"}},[a._v("#")]),a._v(" 访问权限")]),a._v(" "),e("p",[a._v("前面我们讲过，Java的class访问权限分为public、protected、private和默认的包访问权限。引入模块后，这些访问权限的规则就要稍微做些调整。")]),a._v(" "),e("p",[a._v("确切地说，class的这些访问权限只在一个模块内有效，模块和模块之间，例如，a模块要访问b模块的某个class，必要条件是b模块明确地导出了可以访问的包。")]),a._v(" "),e("p",[a._v("举个例子：我们编写的模块"),e("code",[a._v("hello.world")]),a._v("用到了模块"),e("code",[a._v("java.xml")]),a._v("的一个类"),e("code",[a._v("javax.xml.XMLConstants")]),a._v("，我们之所以能直接使用这个类，是因为模块"),e("code",[a._v("java.xml")]),a._v("的"),e("code",[a._v("module-info.java")]),a._v("中声明了若干导出：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("module java.xml {\n    exports java.xml;\n    exports javax.xml.catalog;\n    exports javax.xml.datatype;\n    ...\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("p",[a._v("只有它声明的导出的包，外部代码才被允许访问。换句话说，如果外部代码想要访问我们的"),e("code",[a._v("hello.world")]),a._v("模块中的"),e("code",[a._v("com.itranswarp.sample.Greeting")]),a._v("类，我们必须将其导出：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("module hello.world {\n    exports com.itranswarp.sample;\n\n    requires java.base;\n\trequires java.xml;\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("p",[a._v("因此，模块进一步隔离了代码的访问权限。")]),a._v(" "),e("h3",{attrs:{id:"练习"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#练习"}},[a._v("#")]),a._v(" 练习")]),a._v(" "),e("p",[a._v("请下载并练习如何打包模块和JRE。")]),a._v(" "),e("p",[a._v("从"),e("a",{attrs:{href:"https://gitee.com/",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"data:image/png;base64,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",alt:"img"}}),e("OutboundLink")],1),a._v("下载练习："),e("a",{attrs:{href:"https://gitee.com/liaoxuefeng/learn-java/blob/master/practices/Java%E6%95%99%E7%A8%8B/20.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B.1255943520012800/10.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80.1260451488854880/120.%E6%A8%A1%E5%9D%97.1281795926523938/oop-module.zip?utm_source=blog_lxf",target:"_blank",rel:"noopener noreferrer"}},[a._v("打包模块和JRE"),e("OutboundLink")],1),a._v(" （推荐使用"),e("a",{attrs:{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1266092093733664",target:"_blank",rel:"noopener noreferrer"}},[a._v("IDE练习插件"),e("OutboundLink")],1),a._v("快速下载）")]),a._v(" "),e("h3",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[a._v("#")]),a._v(" 小结")]),a._v(" "),e("p",[a._v("Java 9引入的模块目的是为了管理依赖；")]),a._v(" "),e("p",[a._v("使用模块可以按需打包JRE；")]),a._v(" "),e("p",[a._v("使用模块对类的访问权限有了进一步限制。")])])}),[],!1,null,null,null);s.default=t.exports}}]);